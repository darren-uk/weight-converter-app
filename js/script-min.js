"use strict";const dateInput=document.getElementById("date-input"),weightInput=document.getElementById("weight-input"),hiLowList=document.getElementById("hi-low"),resultsOutput=document.getElementById("results"),graphDiv=document.getElementById("graph-display"),targetInputPounds=document.getElementById("target-input-pounds"),targetInputStone=document.getElementById("target-input-stone"),userMessage=document.getElementById("user-message"),targetStone=document.getElementById("target-stone"),targetPounds=document.getElementById("target-pounds"),targetDisplay=document.getElementById("target"),graphText=document.getElementById("graph-text"),targetLineColor="#36eb36",weightLineColor="#348dc6";let arrow,arrowSet=0,entryNumber=-5;function weightTracker(){let e=weightInput.value,t=dateInput.value;localStorage.setItem(t,e),displayResults()}function storeTarget(){let e,t;e=targetInputPounds.value?parseInt(targetInputPounds.value):0,t=targetInputStone.value?14*targetInputStone.value:0;let n=e+t;localStorage.setItem("target",n),t=parseInt(targetInputStone.value),targetInputPounds.value="",targetInputStone.value="",displayGraph(),displayTargetWeight()}function displayTargetWeight(){localStorage.getItem("target")?(targetStone.innerText=Math.floor(localStorage.getItem("target")/14),targetPounds.innerText=localStorage.getItem("target")%14,targetDisplay.innerText=localStorage.getItem("target")):(targetStone.innerText="0",targetPounds.innerText="0",targetDisplay.innerText="0")}function displayResults(){resultsOutput.innerHTML="";let e=[];for(let t=0;t<localStorage.length;t++){let n=localStorage.key(t);"target"!=n&&""!=n&&e.push(n)}e.sort(),e.reverse();let t=0,n=9e4,a="Your highest record will be shown here",l="your lowest record will be shown here";for(let s=0;s<e.length;s++){let o=localStorage.getItem(e[s]),r=Math.floor(o/14),i=(.071429*o%1*14).toFixed(),g={year:"numeric"},d={day:"numeric"},c={month:"short"},u=new Date(e[s]).toLocaleDateString("en-GB",g),p=new Date(e[s]).toLocaleDateString("en-GB",c),h=new Date(e[s]).toLocaleDateString("en-GB",d);let m=h+function(e){if(e>3&&e<21)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}(h);o>t&&(t=o,a=`<span class="weight-bold">${r}</span> st <span class="weight-bold">${i}</span> lbs <span class=" inline-margin"><span class="red">(</span>${o} lbs<span class="red">)</span></span> | &nbsp; ${u} ${p} ${m}`),o<n&&(n=o,l=`<span class="weight-bold">${r}</span> st <span class="weight-bold">${i}</span> lbs <span class=" inline-margin"><span class="green">(</span>${o} lbs<span class="green">)</span></span> | &nbsp; ${u} ${p} ${m}`);let y,f=s+1;o==localStorage.getItem(e[f])||s==e.length-1?(arrow='<span class="arrow "> -- </span>',y="neutral"):o<localStorage.getItem(e[f])?(arrow='<span class="arrow"> <img src="./images/caret-down-solid.svg" alt="weight loss"> </span>',y="green"):o>localStorage.getItem(e[f])&&(arrow='<span class="arrow"> <img src="./images/caret-up-solid.svg" alt="weight gain"> </span>',y="red");const I=document.createElement("li");I.classList.add("fade","fadeOut");let w=`\n\n\t\t\t<span class="date">${u}   ${p} ${m}</span>\n\t\t\t<span class="weight-stones"><span class="weight-bold">${r}</span> st    <span class="weight-bold">${i}</span> lbs</span>\n\t\t\t<span class="weight-pounds"><span class="${y}">(</span> ${o} lbs <span class="${y}">)</span> ${arrow}</span>\n\n\t\t`;I.innerHTML=w,resultsOutput.appendChild(I),arrowSet=o}hiLowList.innerHTML=`<li>Lowest recorded weight  &nbsp; -  &nbsp; ${l}</li><li>Highest recorded weight  &nbsp; -  &nbsp; ${a}</li>`,displayGraph(),fadeInAnimation()}function backUpCsv(){let e="data:text/csv;charset=utf-8,",t=[];for(let e=0;e<localStorage.length;e++){let n=[],a=localStorage.key(e),l=[a+","+localStorage.getItem(a)];n.push(l),t.push(n)}t.forEach((function(t){let n=t.join(",");e+=n+"\r\n"}));let n="MyWeight_"+(new Date).toLocaleDateString()+".csv",a=encodeURI(e),l=document.createElement("a");l.setAttribute("href",a),l.setAttribute("download",n),document.body.appendChild(l),l.click()}function restoreData(){let e=document.getElementById("csvFileInput").files[0];document.getElementById("csvFileInput").value;if(e){let t=new FileReader;t.readAsText(e),t.onload=function(){let e=t.result.split("\r\n");for(let t=0;t<e.length;t++){let n=e[t].split(",");""!=n&&localStorage.setItem(n[0],n[1])}document.getElementById("csvFileInput").value="",userMessage.innerText="Data stored to local storage",displayResults(),displayTargetWeight(),displayGraph()},t.onerror=function(){userMessage.innerText="There was an error recieving your file, Please try again"+t.error}}else userMessage.innerText="No File selected"}function fileValidation(){var e=document.getElementById("csvFileInput"),t=e.value;if(!/(\.csv)$/i.exec(t))return alert("not '.CSV' file -  Invalid file type\nFile template must be MyWeight_**_**_****.csv"),userMessage.innerText=' Please select again. File template must be "MyWeight_**_**_****.csv"',e.value="",!1}function deleteEntry(){i=document.getElementById("date-input").value,localStorage.removeItem(i),displayResults()}function confirmDelete(){let e;confirm("Press OK to confirm delete of all data")?(e="All data has been deleted",localStorage.clear(),displayResults(),displayTargetWeight(),displayGraph()):e="You pressed Cancel!",document.getElementById("delete-message").innerText=e}function displayGraph(){let e="<h2>TRACK YOUR WEIGHT, ACHIEVE YOUR GOALS</h2><p>Track your weight effortlessly with Weight Tracker. View your weight in stones and pounds, making it easy to monitor your progress. Stay on top of your health goals with detailed tracking and insightful analytics. Start your journey towards a healthier you today</P><br><h3>A graph will display after your first two entries are logged</h3><br><h3>Set your target weight in the drop down menu above</h3>";if(window.localStorage.length<2&&null===localStorage.getItem("target")){document.getElementById("graph-display");let t=document.getElementById("weightChart");graphText.innerHTML=e,t&&t.remove()}else if(window.localStorage.length<3&&localStorage.getItem("target")){document.getElementById("graph-display");let t=document.getElementById("weightChart");graphText.innerHTML=e,t&&t.remove()}else{let e=document.getElementById("graph-display"),t=document.getElementById("weightChart"),n=localStorage.getItem("target");graphText.innerHTML=`\n\t\t\t<h2>Select last <select name="graph-entries" id="graph-entries">\n\t\t\t\t\t\t<option value="">Number of</option>\n\t\t\t\t\t\t<option value="3">3</option>\n                        <option value="5">5</option>\n                        <option value="10">10</option>\n                        <option value="30">30</option>\n                    </select> entries</h2>\n\t\t\t<ul class="legend"><li><span class="weight-dash"></span>Weight.</li><li><span class="target-dash"></span>Target weight = &nbsp;<span class="weight-bold">${Math.floor(n/14)}</span> &nbsp;stone &nbsp; <span class="weight-bold">${n%14}</span> &nbsp; pounds &nbsp; <span class="green">(</span>${Math.floor(n)} pounds<span class="green">)</span></li></ul>\n\t\t\t`,t&&t.remove();let a=document.createElement("canvas");a.id="weightChart",e.appendChild(a),t=document.getElementById("weightChart").getContext("2d");let l=[];for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);"target"!=t&&l.push(t)}l.sort();let s=[];for(let e=0;e<l.length;e++){let t=localStorage.getItem(l[e]);s.push(t)}let o=s.slice(entryNumber);const r=document.getElementById("weightChart"),i=r.getContext("2d"),g=o;let d=[n,n,n,n,n];const c=document.getElementById("graph-display").offsetWidth,u=document.getElementById("graph-display").offsetHeight;r.width=c,r.height=u,r.style.background="#304949";const p=10,h=50,m=g.length,y=(c-(p+h))/(g.length-1),f=Math.max(...g)+5;let I;I=Math.min(...g)<n?Math.min(...g)-2:n-2;const w=f-I,b=(u-2*p)/w;i.beginPath(),i.moveTo(h,p),i.lineTo(h,u-p),i.strokeStyle="#2b4141",i.stroke();for(let e=0;e<=m;e++){i.beginPath();const t=u-p-(I+w/m*e-I)*b;i.moveTo(h,t+5),i.lineTo(c-p,t+5),i.strokeStyle="#ffffff2a",i.stroke()}i.beginPath(),i.moveTo(h,u-p-(g[0]-I)*b),g.forEach(((e,t)=>{const n=h+t*y,a=u-p-(e-I)*b;i.lineTo(n,a)})),i.lineWidth=2,i.strokeStyle="#348dc6",i.stroke(),i.beginPath(),i.moveTo(h,u-p-(d[0]-I)*b),d.forEach(((e,t)=>{const n=c-p,a=u-p-(e-I)*b;i.lineTo(n,a)})),i.lineWidth=2,i.strokeStyle="#36eb36",i.stroke();const v=3;if(g.forEach(((e,t)=>{i.beginPath();const n=h+t*y,a=u-p-(e-I)*b;i.arc(n,a,v,0,2*Math.PI,!0),i.fillStyle="#348dc6",i.fill()})),-3==entryNumber||-5==entryNumber||-10==entryNumber)for(let e=0;e<=m;e++){let t=I+w/m*e;const n=u-p-(t-I)*b;i.fillStyle="#c9d5db",i.font="12px Helvetica",i.fillText(t.toFixed(0)+" lbs",h-50,n+5)}}let t=document.getElementById("graph-entries");t&&t.addEventListener("change",(()=>{entryNumber=0-t.value,displayGraph()}))}function fadeInAnimation(){const e=new IntersectionObserver((function(e,t){e.forEach((e=>{e.isIntersecting?e.target.classList.replace("fadeOut","fadeIn"):e.target.classList.replace("fadeIn","fadeOut")}))}),{root:null,rootMargin:"0px",threshold:1});document.querySelectorAll(".fade").forEach((t=>e.observe(t)))}displayTargetWeight(),weightInput.addEventListener("keydown",(function(e){13===e.keyCode&&(e.preventDefault(),document.getElementById("calculate").click())}));